<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${board.title} + ' - 게시글 상세'"></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h2 th:text="${board.title}">게시글 제목</h2>
        <hr>
        <div class="row mb-3">
            <div class="col-md-6">
                <p><strong>작성자:</strong> <span th:text="${board.user.userid}">작성자ID</span></p>
            </div>
            <div class="col-md-6 text-md-end">
                <p><strong>작성일:</strong> <span th:text="${#temporals.format(board.createdDate, 'yyyy-MM-dd HH:mm')}">2023-01-01 12:00</span></p>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-4">
                <p><strong>카테고리:</strong> <span th:text="${board.category}">IT</span></p>
            </div>
            <div class="col-md-4">
                <p><strong>서브카테고리:</strong> <span th:text="${board.subcategory}">정보통신</span></p>
            </div>
            <div class="col-md-4">
                <p><strong>자격증:</strong> <span th:text="${board.certificateName}">정보처리기사</span></p>
            </div>
        </div>
        <div class="mb-3">
    <p><strong>내용:</strong></p>
    <div class="card p-3">
        <div th:utext="${board.content}"></div> <img th:if="${board.imagePath != null and board.imagePath != ''}"
             th:src="@{${board.imagePath}}"
             alt="첨부 이미지"
             class="img-fluid mt-3"
             style="max-width: 500px;">
    </div>
</div>
<div class="mt-4">
 <a th:href="@{/main}" class="btn btn-secondary">목록으로</a>
                 <button type="button" class="btn btn-danger" id="deleteButton">
                     삭제
                 </button>
            

            </div>
    </div>

        <div class="mt-4">
           
            </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
   <script th:inline="javascript">
        const boardId = /*[[${board.id}]]*/ -1;
        const loggedInUserid = /*[[${loggedInUserid}]]*/ null; // 로그인된 사용자 ID를 JavaScript로 가져옴

        const currentCategory = /*[[${board.category}]]*/ '';
        const currentSubcategory = /*[[${board.subcategory}]]*/ '';
        const currentCertificateName = /*[[${board.certificateName}]]*/ '';
        
        const deleteButton = document.getElementById('deleteButton');

        if (deleteButton) {
            deleteButton.addEventListener('click', function() {
                // ★★★ 이 부분의 로직을 수정합니다. ★★★
                if (loggedInUserid === null || loggedInUserid === 'null') { // loggedInUserid가 null이거나 문자열 "null"인 경우
                    alert('로그인한 사용자만 삭제할 수 있습니다.');
                    return; // 함수 실행을 여기서 중단합니다.
                }

                // 로그인된 경우에만 삭제 확인 메시지를 띄웁니다.
                if (confirm('정말로 이 게시글을 삭제하시겠습니까?')) {
                    const form = document.createElement('form');
                    form.action = '/board/delete/' + boardId;
                    form.method = 'post';
                    
                    const categoryInput = document.createElement('input');
                    categoryInput.type = 'hidden';
                    categoryInput.name = 'category';
                    categoryInput.value = currentCategory;
                    form.appendChild(categoryInput);

                    const subcategoryInput = document.createElement('input');
                    subcategoryInput.type = 'hidden';
                    subcategoryInput.name = 'subcategory';
                    subcategoryInput.value = currentSubcategory;
                    form.appendChild(subcategoryInput);

                    const certificateNameInput = document.createElement('input');
                    certificateNameInput.type = 'hidden';
                    certificateNameInput.name = 'selectedCertificate'; // listBoards에서 이 이름으로 받음
                    certificateNameInput.value = currentCertificateName;
                    form.appendChild(certificateNameInput);
                    
                    
                    document.body.appendChild(form);
                    form.submit();
                }
            });
        }

        // 서버로부터 오는 에러 메시지 처리 (기존과 동일)
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('error') && urlParams.get('error') === 'noPermission') {
            alert('이 게시글을 삭제할 권한이 없습니다.');
        } else if (urlParams.has('error') && urlParams.get('error') === 'notLoggedIn') {
            
            alert('로그인 후 삭제할 수 있습니다.');
        }
    </script>
</body>
</html>